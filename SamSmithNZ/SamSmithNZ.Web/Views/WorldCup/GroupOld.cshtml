@using SamSmithNZ.Service.Models.WorldCup
@using SamSmithNZ.Web.Models.WorldCup
@model GroupViewModel
@{
    ViewBag.Title = "Group " + @Model.RoundCode + " Details";
    Layout = "~/Views/Shared/_LayoutWorldCup.cshtml";
}

<div class="row">
    <div class="col-md-12">
        <form asp-controller="WorldCup" asp-action="GroupPost" asp-route-tournamentCode="@Model.TournamentCode" asp-route-roundNumber="@Model.RoundNumber" method="post">
            <span>Group: </span><select asp-for="RoundCode" asp-items="Model.GroupCodes"></select>
            <button type="submit">Update</button>
        </form>
        @if (Model.IsLastRound == true)
        {
            <span>
                &nbsp;<span style="border-style: solid; border-width: 1px; border-color: darkgray; background-color: gold;">&nbsp;World Cup Champion&nbsp;</span>
                &nbsp;<span style="border-style: solid; border-width: 1px; border-color: darkgray; background-color: silver;">&nbsp;2nd Place&nbsp;</span>
                &nbsp;<span style="border-style: solid; border-width: 1px; border-color: darkgray; background-color: #A67D3D;">&nbsp;3rd Place&nbsp;</span>
            </span>
        }
        else
        {
            <span>
                &nbsp;<span style="border-style: solid; border-width: 1px; border-color: darkgray; background-color: #CCFF99;">&nbsp;Team advances to next round&nbsp;</span>
            </span>
        }
        @if (Model.TeamWithdrew == true)
        {
            <span>
                &nbsp;<span style="border-style: solid; border-width: 1px; border-color: darkgray; background-color: #FFCCCC;">&nbsp;Team withdrew prior to start of tournament&nbsp;</span>
            </span>
        }
    </div>
</div>
<br />

<div class="row">
    <div class="col-md-12">
        <table class="table table-bordered">
            <tr>
                <th>Team</th>
                <th>Played</th>
                <th>Wins</th>
                <th>Draws</th>
                <th>Losses</th>
                <th>GF</th>
                <th>GA</th>
                <th>GD</th>
                <th>Points</th>
                <th>ELO Rating</th>
            </tr>
            @foreach (Group item in Model.Groups)
            {
                <tr style="background-color: @Model.GetGroupRowStyle(item.HasQualifiedForNextRound, item.GroupRanking, item.TeamWithdrew, Model.IsLastRound);">
                    <td>
                        <img src="~/WorldCup/Teams/@item.TeamFlagName" Class="TeamImage" />
                        <a href="/WorldCup/Team?TeamCode=@item.TeamCode">@item.TeamName</a>
                    </td>
                    <td>@item.Played</td>
                    <td>@item.Wins</td>
                    <td>@item.Draws</td>
                    <td>@item.Losses</td>
                    <td>@item.GoalsFor</td>
                    <td>@item.GoalsAgainst</td>
                    <td>@item.GoalDifference</td>
                    <td>@item.Points</td>
                    <td>@item.ELORating</td>
                </tr>
            }
        </table>
    </div>
</div>
<br />

<div class="row">
    <div class="col-md-12">
        <table class="table table-bordered">
            <tr>
                <th>Game #</th>
                <th>Game Time</th>
                <th>Round</th>
                <th>Group Name</th>
                <th>Round</th>
                <th></th>
                @*<th>Team 1 (Prob to win)</th>*@
                <th>Score</th>
                <th></th>
                @*<th>Team 2 (Prob to win)</th>*@
                <th>Location</th>
            </tr>
            @foreach (Game item in Model.Games)
            {
                <tr style="background-color: @Model.GetGameRowStyle(item.GameCode)">
                    <td>
                        @if (item.RowType == 1)
                        {
                            <div>@item.GameNumber</div>
                        }
                    </td>
                    <td>
                        @if (item.RowType == 1)
                        {
                            <div>@item.GameTime.ToString("dd-MMM-yyyy HH:mm")</div>
                        }
                    </td>
                    <td>
                        @if (item.RowType == 1)
                        {
                            <div>@item.RoundNumber</div>
                        }
                    </td>
                    <td>
                        @if (item.RowType == 1)
                        {
                            <div>@item.RoundName</div>
                        }
                    </td>
                    <td>
                        @if (item.RowType == 1)
                        {
                            <div>@item.RoundCode</div>
                        }
                    </td>
                    <td style="text-align: right;">
                        @if (item.RowType == 1)
                        {
                            <div>
                                @*<span ng-if="item.Team1NormalTimeScore">(@item.Team1ChanceToWin | percent to win) </span>*@
                                <a href="/WorldCup/Team?TeamCode=@item.Team1Code">@item.Team1Name</a>
                                <img src="~/WorldCup/Teams/@item.Team1FlagName" Class="TeamImage" />
                            </div>
                        }
                        else if (item.RowType >= 2 && item.Team1NormalTimeScore != null)
                        {
                            <div>
                                @item.Team1Name
                                <img src="~/WorldCup/Soccerball_svg.png" /> @item.Team1NormalTimeScore' @if (item.Team1ExtraTimeScore > 0)
                                {<span>+@item.Team1ExtraTimeScore'</span>} @if (item.IsPenalty == true)
                                {<span> (pen)</span>}@if (item.IsOwnGoal == true)
                                {<span> (og)</span>}
                            </div>
                        }
                    </td>
                    <td style="text-align: center;">
                        @if (item.Team1NormalTimeScore >= 0 && item.RowType == 1)
                        {
                            <div>
                                @if (item.Team1PenaltiesScore == null && item.Team1NormalTimeScore != null)
                                {
                                    <span>
                                        @item.Team1ResultRegulationTimeScore - @item.Team2ResultRegulationTimeScore @item.Team1ResultInformation@item.Team2ResultInformation
                                    </span>
                                }
                                @if (item.Team1PenaltiesScore != null && item.Team1PenaltiesScore >= 0)
                                {
                                    <div>
                                        <span>@item.Team1ResultRegulationTimeScore - @item.Team2ResultRegulationTimeScore (aet)</span>
                                        <br />
                                        @item.Team1PenaltiesScore - @item.Team2PenaltiesScore @item.Team1ResultInformation@item.Team2ResultInformation
                                    </div>
                                }
                            </div>
                        }
                        else if (item.Team1NormalTimeScore == null && item.RowType == 1 && item.Team1PreGameEloRating >= 0)
                        {
                            <div>
                                Chance to win:<br />
                                @((item.Team1ChanceToWin - item.Team2ChanceToWin).ToString("0.00%"))
                            </div>
                        }
                    </td>
                    <td style="text-align: left;">
                        @if (item.RowType == 1)
                        {
                            <div>
                                <img src="~/WorldCup/Teams/@item.Team2FlagName" Class="TeamImage" />
                                <a href="/WorldCup/Team?TeamCode=@item.Team2Code">@item.Team2Name</a>
                                @*<span ng-if="item.Team2NormalTimeScore == null">(@item.Team2ChanceToWin | percent to win) </span>*@
                            </div>
                        }
                        else if (item.RowType >= 2 && item.Team2NormalTimeScore != null)
                        {
                            <div>
                                @item.Team2Name
                                <img src="~/WorldCup/Soccerball_svg.png" /> @item.Team2NormalTimeScore' @if (item.Team2ExtraTimeScore > 0)
                                {<span>+@item.Team2ExtraTimeScore'</span>} @if (item.IsPenalty == true)
                                {<span> (pen)</span>}@if (item.IsOwnGoal == true)
                                {<span> (og)</span>}
                            </div>
                        }
                    </td>
                    <td>
                        @if (item.RowType == 1)
                        {
                            <div>@item.Location</div>
                        }
                    </td>
                </tr>
            }
        </table>
    </div>
</div>

